# AI 全栈脚手架初始化

**创建日期**: 2026-01-25
**状态**: 待确认

## 需求概述

初始化 AI Skeleton 项目的基础代码结构，包括前端和后端的目录结构、配置文件、基础框架代码，使项目可以正常启动和运行。

## 项目结构

### 后端结构（Go + Gin + GORM）

```
backend/
├── internal/            # 内部代码
│   ├── http/           # HTTP 相关
│   │   ├── api/        # API 处理器
│   │   │   └── health.go # 健康检查 API
│   │   ├── router/     # 路由配置
│   │   │   └── router.go # 路由注册
│   │   └── middleware/ # 中间件
│   │       └── middleware.go # CORS、日志等中间件
│   ├── service/        # 业务逻辑层
│   │   └── health/     # 健康检查服务
│   │       ├── health_service.go
│   │       └── health_service_test.go
│   ├── repository/     # 数据访问层
│   ├── model/          # 数据模型
│   ├── mcp/            # MCP 协议适配
│   │   └── adapter.go  # MCP 适配器基础结构
│   ├── config/         # 配置管理
│   │   └── config.go   # 配置加载
│   ├── common/         # 公共代码
│   │   ├── errors.go   # 错误定义
│   │   └── response.go # 响应结构
│   └── testutil/       # 测试工具
│       ├── mock/       # Mock 对象
│       ├── factory.go  # 测试数据工厂
│       └── assert.go   # 断言函数
├── cmd/                # 应用入口
│   ├── server/
│   │   └── main.go     # 服务启动入口
│   └── gen/
│       └── main.go     # Gen-GORM 代码生成入口
├── go.mod              # Go 模块定义
├── go.sum              # 依赖锁定
├── .air.toml           # Air 热重载配置
└── Dockerfile          # 后端 Docker 镜像
```

### 前端结构（React + Vite + Ant Design v5）

```
frontend/
├── src/
│   ├── pages/           # 页面组件
│   │   └── Home.tsx    # 首页
│   ├── components/      # 公共组件
│   ├── services/        # API 服务
│   │   └── api.ts      # API 请求封装
│   ├── App.tsx          # 根组件
│   └── main.tsx         # 入口文件
├── public/              # 静态资源
├── index.html           # HTML 模板
├── package.json         # 依赖配置
├── tsconfig.json        # TypeScript 配置
├── vite.config.ts       # Vite 配置
└── Dockerfile           # 前端 Docker 镜像
```

## 功能清单

### 1. 后端基础功能

#### 1.1 项目初始化
- [x] 创建 Go 模块（`go mod init`）
- [x] 安装核心依赖：
  - `github.com/gin-gonic/gin` - HTTP 框架
  - `gorm.io/gorm` - ORM
  - `gorm.io/driver/mysql` - MySQL 驱动
  - `gorm.io/gen` - 代码生成
  - `github.com/swaggo/gin-swagger` - Swagger
  - `github.com/spf13/viper` - 配置管理
  - `github.com/stretchr/testify` - 测试工具

#### 1.2 基础服务
- [x] HTTP 服务器启动（Gin）
- [x] 健康检查接口 `GET /health`
- [x] CORS 中间件
- [x] 日志中间件
- [x] 配置文件加载（支持 .env）

#### 1.3 MCP 协议支持
- [x] MCP 适配器基础结构
- [x] 工具注册机制
- [x] 协议转换接口定义

#### 1.4 测试基础设施
- [x] 测试工具函数（testutil）
- [x] Mock 基础结构
- [x] 表驱动测试示例

### 2. 前端基础功能

#### 2.1 项目初始化
- [x] 使用 Vite 创建 React + TypeScript 项目
- [x] 安装核心依赖：
  - `react` + `react-dom`
  - `antd` v5
  - `axios` - HTTP 客户端
  - `react-router-dom` - 路由

#### 2.2 基础页面
- [x] 首页（Home）- 显示项目信息和健康状态
- [x] 使用 Ant Design 组件布局

#### 2.3 API 服务
- [x] Axios 封装
- [x] 健康检查 API 调用

### 3. 开发工具配置

#### 3.1 Makefile
- [x] `make frontend-dev` - 启动前端开发服务器
- [x] `make backend-dev` - 启动后端开发服务器（Air 热重载）
- [x] `make gen-swagger` - 生成 Swagger 文档
- [x] `make gen-sql` - 生成 Gen-GORM 代码

#### 3.2 Air 配置
- [x] `.air.toml` - 后端热重载配置

#### 3.3 Docker
- [x] 后端 Dockerfile（多阶段构建）
- [x] 前端 Dockerfile（多阶段构建）

## API 接口设计

### 健康检查接口

**接口**: `GET /api/v1/health`

**描述**: 检查服务健康状态

**请求参数**: 无

**响应示例**:
```json
{
  "status": "ok",
  "timestamp": "2026-01-25T10:00:00Z",
  "version": "1.0.0"
}
```

**Swagger 注释**:
```go
// @Summary 健康检查
// @Description 检查服务健康状态
// @Tags 系统
// @Accept json
// @Produce json
// @Success 200 {object} HealthResponse
// @Router /api/v1/health [get]
```

## 数据模型

初始化阶段暂不涉及数据库表，仅定义基础响应结构：

```go
// common/response.go
type Response struct {
    Code    int         `json:"code"`
    Message string      `json:"message"`
    Data    interface{} `json:"data,omitempty"`
}

type HealthResponse struct {
    Status    string `json:"status"`
    Timestamp string `json:"timestamp"`
    Version   string `json:"version"`
}
```

## 配置文件

### 后端配置（.env）

```bash
# 服务配置
SERVER_PORT=8080
SERVER_MODE=debug

# 数据库配置（暂不使用）
# DB_HOST=localhost
# DB_PORT=3306
# DB_USER=root
# DB_PASSWORD=
# DB_NAME=ai_skeleton

# 日志配置
LOG_LEVEL=debug
```

### 前端配置（.env）

```bash
VITE_API_BASE_URL=http://localhost:8080
```

## MCP 工具定义

初始化阶段定义 MCP 适配器接口：

```go
// mcp/adapter.go
type MCPAdapter interface {
    // RegisterTool 注册 MCP 工具
    RegisterTool(name string, schema ToolSchema, handler ToolHandler) error

    // HandleRequest 处理 MCP 请求
    HandleRequest(ctx context.Context, req *MCPRequest) (*MCPResponse, error)
}

type ToolSchema struct {
    Name        string                 `json:"name"`
    Description string                 `json:"description"`
    Parameters  map[string]interface{} `json:"parameters"`
}

type ToolHandler func(ctx context.Context, params map[string]interface{}) (interface{}, error)
```

## 产品交互流程

### 开发者使用流程

1. **克隆项目**
   ```bash
   git clone <repo>
   cd ai_skeleton
   ```

2. **启动后端**
   ```bash
   cd backend
   cp .env.example .env
   make backend-dev
   ```
   - 后端服务启动在 `http://localhost:8080`
   - Air 监听文件变化，自动重启

3. **启动前端**
   ```bash
   cd frontend
   npm install
   make frontend-dev
   ```
   - 前端服务启动在 `http://localhost:5173`
   - Vite 热更新

4. **验证服务**
   - 访问 `http://localhost:5173` 查看前端页面
   - 访问 `http://localhost:8080/api/v1/health` 查看健康检查
   - 前端页面显示后端健康状态

## 技术实现要点

### 后端

1. **依赖注入**
   - Service 层定义接口
   - 通过构造函数注入依赖
   - 便于测试和 mock

2. **错误处理**
   - 统一错误定义在 `common/errors.go`
   - 使用 Gin 的错误处理中间件

3. **配置管理**
   - 使用 Viper 加载配置
   - 支持环境变量覆盖

4. **测试**
   - 表驱动测试
   - Mock 接口
   - 测试辅助函数

### 前端

1. **Ant Design 规范**
   - 使用 Layout、Card、Typography 等组件
   - 不自定义样式
   - 使用 antd 的 theme 配置

2. **API 调用**
   - Axios 统一封装
   - 请求/响应拦截器
   - 错误处理

3. **路由**
   - React Router v6
   - 路由懒加载

## 验收标准

### 后端
- [ ] `make backend-dev` 可以成功启动服务
- [ ] 访问 `http://localhost:8080/api/v1/health` 返回正确的 JSON
- [ ] Air 热重载正常工作（修改代码自动重启）
- [ ] 代码符合三层架构规范
- [ ] 包含测试示例

### 前端
- [ ] `make frontend-dev` 可以成功启动服务
- [ ] 访问 `http://localhost:5173` 显示首页
- [ ] 首页使用 Ant Design 组件
- [ ] 可以调用后端健康检查接口并显示结果
- [ ] Vite 热更新正常工作

### 整体
- [ ] Makefile 所有命令可以正常执行
- [ ] 项目结构符合 CLAUDE.md 规范
- [ ] 包含必要的配置文件和文档

## 后续扩展

初始化完成后，可以基于此脚手架快速开发：
- 添加用户认证模块
- 添加数据库表和 CRUD 操作
- 添加更多 MCP 工具
- 添加前端路由和页面
- 添加单元测试和集成测试

---

**注意事项**：
1. 所有代码必须符合 CLAUDE.md 中定义的规范
2. 前端严格使用 Ant Design v5 组件，不自定义样式
3. 后端使用简单三层架构，便于 AI 理解和测试
4. 代码必须包含必要的注释和文档
